
.row
  .col-md-6
    .card.mb-3
      %h5.card-header
        Öppettider

      %table.table.table-sm
        %col.td-col-sm
        %col.td-col-xl

        %tbody
          %tr.m-0
            %td{colspan: 3}
              = simple_form_for [:admin, @view, Hour.new()], defaults: {label: false}, html: {class: 'form-inline'} do |form|
                = form.input_field :day_of_week, as: :select, collection: (1..5).map {|i| [I18n.t('date.day_names')[i], i]}, class: 'form-control form-control-sm mr-2', include_blank: 'Veckodag'
                = form.input_field :opens, class: 'form-control form-control-sm mr-2', placeholder: '08:00', as: :string
                = form.input_field :closes, class: 'form-control form-control-sm mr-2', placeholder: '15:00', as: :string
                = form.input_field :note, class: 'form-control form-control-sm mr-2', placeholder: 'Notis'
                = form.submit 'Spara', class: 'btn btn-sm btn-success'
          - @view.hours.each do |hour|
            %tr.m-0{class: ('table-info' if hour.today?)}
              %th.pl-3.pr-3
                = hour.day_name
              %td
                = best_in_place hour, :opens, as: :input, url: admin_preschool_hour_path(@view, hour), value: hour.opens_short, display_as: :opens_short, html_attrs: {'length' => 5, 'maxlength'=>  5}
                \-
                = best_in_place hour, :closes, as: :input, url: admin_preschool_hour_path(@view, hour), value: hour.closes_short, display_as: :closes_short, html_attrs: {length: 5, maxlength: 5}
                %small.pl-1
                  //= hour.note
                  = best_in_place hour, :note, as: :input, url: admin_preschool_hour_path(@view, hour), value: hour.note, place_holder: '...'
              %td
                = link_to admin_preschool_hour_path(@view, hour), method: :delete, data: {confirm: 'Äru säker?'} do
                  = fa_icon :trash

    .card.mb-3
      %h5.card-header
        Avvikande öppettider

      %table.table.table-sm
        %col.td-col-md
        %col.td-col-sm
        %col.td-col-xl
        %col.td-col-sm
        %tbody
          %tr.m-0
            %td{colspan: 6}
              = simple_form_for [:admin, @view, TempHour.new()], defaults: {label: false}, html: {class: 'form-inline'} do |form|
                = form.input :closed_for_day, as: :boolean, label: "Stängd hela dagen"
                #datetimepicker-opens.datetimepicker.input-group.date{"data-target-input" => "nearest"}
                  = form.input_field :opens_at, as: :string, class: "form-control form-control-sm ml-2", data: {target: "#datetimepicker-opens"}
                  .input-group-append{"data-target" => "#datetimepicker-opens", "data-toggle" => "datetimepicker"}
                    .input-group-text
                      %i.fa.fa-calendar
                #datetimepicker-closes.datetimepicker.input-group.date{"data-target-input" => "nearest"}
                  = form.input_field :closes_at, as: :string, class: "form-control form-control-sm ml-2", data: {target: "#datetimepicker-closes"}
                  .input-group-append{"data-target" => "#datetimepicker-closes", "data-toggle" => "datetimepicker"}
                    .input-group-text
                      %i.fa.fa-calendar
                = form.submit 'Spara', class: 'btn btn-sm btn-success ml-2'
          - @view.temp_hours.this_year.each do |hour|
            %tr.m-0{class: ('table-info' if hour.today?)}
              %td.pl-3.pr-3
                = hour.day_and_date
              %td{class: hour.closed_for_day ? "strike text-danger" : ""}
                = hour.opens_at_short
              %td{class: hour.closed_for_day ? "strike text-danger" : ""}
                = hour.closes_at_short
              %td
                = link_to admin_preschool_temp_hour_path(@view, hour), method: :delete, data: {confirm: 'Äru säker?'} do
                  = fa_icon :trash

  .col-md-6
    .card.mb-3
      %h5.card-header
        Förändringar
      #site_changes
        %ul.list-group.list-group-flush
          = render partial: 'admin/preschools/show/site_change', collection: @view.site_changes.not_done.order("state = 'active' DESC, state ='new' DESC, created_at DESC")

